import React,{useMemo,useEffect,useState} from 'react';import Card from '../ui/Card.jsx';import StatCard from '../ui/StatCard.jsx';import StockDonut from '../ui/StockDonut.jsx';import { COLORS,HPP } from '../../utils/constants.js';import { fmtIDR } from '../../utils/helpers.js';import { DataService } from '../../services/DataService.js';export default function DashboardView({stocks={}}){const isi=Number(stocks.ISI||0),kosong=Number(stocks.KOSONG||0),total=isi+kosong;const [sum,setSum]=useState({qty:0,omzet:0,laba:0});useEffect(()=>{let on=true;(async()=>{try{const rows=await DataService.loadSales(200);const qty=rows.reduce((a,b)=>a+Number(b.qty||0),0);const omzet=rows.reduce((a,b)=>a+Number(b.total||0),0);const hpp=rows.reduce((a,b)=>a+(Number(b.qty||0)*HPP),0);const laba=omzet-hpp;if(on) setSum({qty,omzet,laba});}catch{}})();return()=>{on=false};},[]);const donut=[{label:'ISI',value:isi,color:COLORS.primary},{label:'KOSONG',value:kosong,color:COLORS.danger}];return(<div className='grid'><div style={{display:'flex',alignItems:'baseline',justifyContent:'space-between',gap:12}}><div><h2 style={{margin:0}}>Dashboard</h2><p style={{margin:'4px 0 0',color:'#64748b',fontSize:13}}>Ringkasan stok & penjualan.</p></div><div style={{padding:'6px 10px',borderRadius:999,fontSize:12,background:'#f1f5f9'}}>Total Tabung: <b>{total}</b></div></div><section className='grid' style={{gridTemplateColumns:'repeat(auto-fit,minmax(220px,1fr))'}}><StatCard title='Stok Isi' value={isi} subtitle='Siap jual' color={COLORS.primary} icon='ðŸŸ¢'/><StatCard title='Stok Kosong' value={kosong} subtitle='Tabung kembali' color={COLORS.danger} icon='âšª'/><StatCard title='Total Terjual (riwayat)' value={sum.qty} subtitle='Akumulasi data' color={COLORS.info} icon='ðŸ§®'/><StatCard title='Laba (akumulasi)' value={fmtIDR(sum.laba)} subtitle={`HPP @ ${fmtIDR(HPP)}`} color={COLORS.success} icon='ðŸ’°'/></section><section className='grid' style={{gridTemplateColumns:'repeat(auto-fit,minmax(280px,1fr))'}}><Card title='Distribusi Stok'><div style={{display:'grid',justifyItems:'center',gap:12}}><StockDonut data={donut} size={200} thickness={22}/><div style={{display:'grid',gridTemplateColumns:'repeat(2,1fr)',gap:8,width:'100%'}}>{donut.map(d=>(<div key={d.label} style={{display:'flex',alignItems:'center',gap:8}}><span aria-hidden style={{width:10,height:10,background:d.color,borderRadius:2,display:'inline-block'}}/><span style={{fontSize:12,color:'#6b7280'}}>{d.label}</span><span style={{marginLeft:'auto',fontWeight:600}}>{d.value}</span></div>))}</div></div></Card><Card><div style={{display:'grid',gap:6}}><div style={{display:'flex',justifyContent:'space-between'}}><span>Omzet</span><b>{fmtIDR(sum.omzet)}</b></div><div style={{display:'flex',justifyContent:'space-between'}}><span>HPP</span><b>âˆ’ {fmtIDR(sum.omzet - sum.laba)}</b></div><div style={{display:'flex',justifyContent:'space-between'}}><span>Laba</span><b style={{color:COLORS.success}}>{fmtIDR(sum.laba)}</b></div></div></Card></section></div>)}